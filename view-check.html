<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Etude - צפייה בקבלה</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .check-view {
            width: 148mm;
            min-height: 210mm;
            margin: 20px auto;
            padding: 15mm;
            background: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            font-family: 'Arial', sans-serif;
        }
        
        .check-header {
            text-align: center;
            border-bottom: 2px solid #000;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        .check-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .items-table th, .items-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: right;
        }
        
        .items-table th {
            background-color: #f5f5f5;
            font-weight: bold;
        }
        
        .summary {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: right;
        }
        
        .signature {
            margin-top: 50px;
            text-align: left;
            border-top: 1px solid #000;
            padding-top: 10px;
        }
        
        .actions {
            text-align: center;
            margin: 20px 0;
        }
        
        @media print {
            .actions {
                display: none;
            }
        }
        
        @media (max-width: 768px) {
            .check-view {
                width: 95%;
                margin: 10px auto;
                padding: 10px;
            }
            
            .check-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="actions">
            <button onclick="printCheck()" class="primary-btn">הדפס</button>
            <button onclick="window.close()" class="secondary-btn">סגור</button>
        </div>

        <div class="check-view" id="checkContentView">
            <!-- Контент чека будет загружен через JavaScript -->
        </div>
    </div>

    <script>
        function loadCheck() {
            const receiptNumber = localStorage.getItem('viewCheckNumber');
            const checks = JSON.parse(localStorage.getItem('checks') || '[]');
            const check = checks.find(c => c.receiptNumber == receiptNumber);
            
            if (!check) {
                document.getElementById('checkContentView').innerHTML = '<p>קבלה לא נמצאה</p>';
                return;
            }

            const checkHTML = `
                <div class="check-header">
                    <h2>Etude - קבלה</h2>
                    <p>יבגניה גרומובה</p>
                    <p>הבה״דים 4, ראשל״צ</p>
                    <p>נייד: 0534726469 | עסק מורשה: 346776909</p>
                </div>
                
                <div class="check-details">
                    <div>
                        <p><strong>מספר קבלה:</strong> ${check.receiptNumber}</p>
                        <p><strong>תאריך:</strong> ${check.date}</p>
                        <p><strong>סוג תשלום:</strong> ${getPaymentTypeHebrew(check.paymentType)}</p>
                    </div>
                    <div>
                        <p><strong>לקוח:</strong> ${check.customerName}</p>
                        ${check.customerId ? `<p><strong>ח.פ./ע.מ:</strong> ${check.customerId}</p>` : ''}
                        ${check.customerAddress ? `<p><strong>כתובת:</strong> ${check.customerAddress}</p>` : ''}
                        ${check.customerPhone ? `<p><strong>טלפון:</strong> ${check.customerPhone}</p>` : ''}
                    </div>
                </div>
                
                <table class="items-table">
                    <thead>
                        <tr>
                            <th>פרטים</th>
                            <th>כמות</th>
                            <th>מחיר</th>
                            <th>סכום</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${check.items.map(item => `
                            <tr>
                                <td>${item.details}</td>
                                <td>${item.quantity}</td>
                                <td>${item.amount.toFixed(2)} ₪</td>
                                <td>${(item.amount * item.quantity).toFixed(2)} ₪</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                
                <div class="summary">
                    <p>סה״כ לפני מע״מ: ${check.subtotal.toFixed(2)} ₪</p>
                    <p>מע״מ (18%): ${check.vat.toFixed(2)} ₪</p>
                    <p><strong>סה״כ כולל מע״מ: ${check.total.toFixed(2)} ₪</strong></p>
                </div>
                
                <div class="signature">
                    <p>חתימה: _________________________</p>
                    <p>שם המוכר: יבגניה גרומובה</p>
                </div>
            `;
            
            document.getElementById('checkContentView').innerHTML = checkHTML;
        }

        function getPaymentTypeHebrew(type) {
            const types = {
                'cash': 'מזומן',
                'credit': 'אשראי',
                'check': 'צ\'ק',
                'transfer': 'העברה'
            };
            return types[type] || type;
        }

        function printCheck() {
            window.print();
        }

        document.addEventListener('DOMContentLoaded', loadCheck);
    </script>
</body>
</html>
