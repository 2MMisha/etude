<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Etude - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .clients-management {
            display: grid;
            gap: 2rem;
            grid-template-columns: 1fr;
        }
        
        @media (min-width: 992px) {
            .clients-management {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        .client-form-card, .clients-list-card {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .client-card {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            border-left: 4px solid #667eea;
            transition: all 0.3s;
        }
        
        .client-card:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .client-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }
        
        .client-name {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
            margin: 0;
        }
        
        .client-details {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .client-details p {
            margin: 0.25rem 0;
        }
        
        .client-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .search-box {
            margin-bottom: 1.5rem;
        }
        
        .search-box input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .clients-stats {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-left">
                <h1>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏</h1>
                <p>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ Etude</p>
            </div>
            <div class="header-right">
                <button onclick="window.location.href='main.html'" class="secondary-btn">‚Üê –ù–∞–∑–∞–¥</button>
                <button onclick="logout()" class="logout-btn">–í—ã—Ö–æ–¥</button>
            </div>
        </header>

        <div class="clients-management">
            <div class="client-form-card">
                <h3>üë§ –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞</h3>
                <form id="clientForm">
                    <div class="form-group">
                        <label for="clientName">–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞ *:</label>
                        <input type="text" id="clientName" required placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω–æ–µ –∏–º—è">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="clientTaxId">–ù–∞–ª–æ–≥–æ–≤—ã–π –Ω–æ–º–µ—Ä:</label>
                            <input type="text" id="clientTaxId" placeholder="–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ">
                        </div>
                        <div class="form-group">
                            <label for="clientPhone">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                            <input type="tel" id="clientPhone" placeholder="–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="clientAddress">–ê–¥—Ä–µ—Å:</label>
                        <input type="text" id="clientAddress" placeholder="–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ">
                    </div>
                    
                    <div class="form-group">
                        <label for="clientNotes">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:</label>
                        <textarea id="clientNotes" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è" rows="3"></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="primary-btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</button>
                        <button type="button" onclick="clearForm()" class="secondary-btn">–û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É</button>
                    </div>
                </form>
            </div>

            <div class="clients-list-card">
                <div class="clients-stats">
                    <h4>–í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤: <span id="totalClients">0</span></h4>
                </div>
                
                <div class="search-box">
                    <input type="text" id="clientSearch" placeholder="üîç –ü–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤...">
                </div>
                
                <div id="clientsList">
                    <!-- Clients will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script src="github-storage.js"></script>
    <script>
        if (!localStorage.getItem('loggedIn')) {
            window.location.href = 'index.html';
        }

        let allClients = [];

        document.addEventListener('DOMContentLoaded', async function() {
            await loadClients();
            setupEventListeners();
        });

        function setupEventListeners() {
            document.getElementById('clientForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveClient();
            });

            document.getElementById('clientSearch').addEventListener('input', function() {
                filterClients(this.value);
            });
        }

        async function loadClients() {
            try {
                allClients = await window.githubStorage.loadCustomers();
                allClients.sort((a, b) => a.name.localeCompare(b.name));
                displayClients(allClients);
                updateStats();
            } catch (error) {
                console.error('Error loading clients:', error);
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤: ' + error.message);
            }
        }

        function displayClients(clients) {
            const container = document.getElementById('clientsList');
            
            if (clients.length === 0) {
                container.innerHTML = '<div class="empty-state">–ö–ª–∏–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                return;
            }

            container.innerHTML = clients.map(client => `
                <div class="client-card">
                    <div class="client-header">
                        <div>
                            <h4 class="client-name">${client.name}</h4>
                            <div class="client-details">
                                ${client.phone ? `<p>üìû ${client.phone}</p>` : ''}
                                ${client.taxId ? `<p>üî¢ –ù–∞–ª–æ–≥–æ–≤—ã–π –Ω–æ–º–µ—Ä: ${client.taxId}</p>` : ''}
                                ${client.address ? `<p>üè† ${client.address}</p>` : ''}
                                ${client.notes ? `<p>üìù ${client.notes}</p>` : ''}
                                <p>üìÖ –î–æ–±–∞–≤–ª–µ–Ω: ${new Date(client.createdAt).toLocaleDateString('ru-RU')}</p>
                            </div>
                        </div>
                        <div class="client-actions">
                            <button onclick="editClient('${client.id}')" class="small-btn">‚úèÔ∏è</button>
                            <button onclick="deleteClient('${client.id}')" class="small-btn delete-btn">üóëÔ∏è</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function filterClients(query) {
            const filtered = allClients.filter(client => 
                client.name.toLowerCase().includes(query.toLowerCase()) ||
                (client.phone && client.phone.includes(query)) ||
                (client.taxId && client.taxId.includes(query)) ||
                (client.address && client.address.toLowerCase().includes(query.toLowerCase()))
            );
            displayClients(filtered);
        }

        function updateStats() {
            document.getElementById('totalClients').textContent = allClients.length;
        }

        async function saveClient() {
            const name = document.getElementById('clientName').value.trim();
            const taxId = document.getElementById('clientTaxId').value.trim();
            const phone = document.getElementById('clientPhone').value.trim();
            const address = document.getElementById('clientAddress').value.trim();
            const notes = document.getElementById('clientNotes').value.trim();

            if (!name) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∫–ª–∏–µ–Ω—Ç–∞');
                return;
            }

            try {
                const clients = await window.githubStorage.loadCustomers();
                const newClient = {
                    id: Date.now().toString(),
                    name: name,
                    taxId: taxId,
                    phone: phone,
                    address: address,
                    notes: notes,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                clients.push(newClient);
                await window.githubStorage.saveCustomers(clients);
                
                clearForm();
                await loadClients();
                alert('‚úÖ –ö–ª–∏–µ–Ω—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞: ' + error.message);
            }
        }

        function clearForm() {
            document.getElementById('clientForm').reset();
        }

        function editClient(clientId) {
            const client = allClients.find(c => c.id === clientId);
            if (client) {
                document.getElementById('clientName').value = client.name;
                document.getElementById('clientTaxId').value = client.taxId || '';
                document.getElementById('clientPhone').value = client.phone || '';
                document.getElementById('clientAddress').value = client.address || '';
                document.getElementById('clientNotes').value = client.notes || '';
                
                // Scroll to form
                document.getElementById('clientForm').scrollIntoView({ behavior: 'smooth' });
                
                // TODO: Implement proper edit functionality
                alert('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: –∏–∑–º–µ–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞"');
            }
        }

        async function deleteClient(clientId) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞?')) {
                try {
                    const clients = await window.githubStorage.loadCustomers();
                    const updatedClients = clients.filter(client => client.id !== clientId);
                    await window.githubStorage.saveCustomers(updatedClients);
                    await loadClients();
                    alert('–ö–ª–∏–µ–Ω—Ç —É–¥–∞–ª–µ–Ω');
                } catch (error) {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞: ' + error.message);
                }
            }
        }

        function logout() {
            localStorage.removeItem('loggedIn');
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
